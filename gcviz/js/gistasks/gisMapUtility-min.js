(function(){define(["kineticpanning","gcviz-func","dijit/Menu","dijit/MenuItem","dijit/PopupMenuItem","esri/map","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/geometry/Extent","esri/geometry/Point"],function(x,i,a,f,c){var q={},A,b,n,g,E,o,w,H,m,k,B,j,e,h,F,v,G,I,C,d,l,z=[],t,s,D,y={},r,p,u=false;A=function(K,L,R){var Q=L.extent,N=L.sr.wkid,Q=new esri.geometry.Extent({xmin:Q.xmin,ymin:Q.ymin,xmax:Q.xmax,ymax:Q.ymax,spatialReference:{wkid:N}}),R=new esri.geometry.Extent({xmin:R.xmin,ymin:R.ymin,xmax:R.xmax,ymax:R.ymax,spatialReference:{wkid:N}}),O=L.lods,S,J,P=K.split("_")[0],M;if(O.length){S={extent:Q,spatialReference:{wkid:N},logo:false,showAttribution:false,lods:O,wrapAround180:true,smartNavigation:false}}else{S={extent:Q,spatialReference:{wkid:N},logo:false,showAttribution:false,wrapAround180:true,smartNavigation:false}}J=new esri.Map(K,S);q[P]=J;M=new x(J);M.enableMouse();J.vInitExtent=Q;J.vFullExtent=R;J.vIdName=P;J.vWkid=N;J.vInsetId=[];J.on("load",function(){J.resize();J.enableScrollWheelZoom();J.isZoomSlider=false;if(L.link){z.push({name:J.vIdName,fire:false});o(J)}else{w(J)}p=z.length});return J};b=function(Q,J,K){var P=J.extent,N=J.sr.wkid,M=new esri.geometry.Extent({xmin:P.xmin,ymin:P.ymin,xmax:P.xmax,ymax:P.ymax,spatialReference:{wkid:N}}),O,L;O=new esri.Map(Q,{extent:M,spatialReference:{wkid:N},logo:false,showAttribution:false,smartNavigation:false});L=new x(O);L.enableMouse();O.vWkid=N;O.vType=J.type;O.on("load",function(){O.resize();O.disableMapNavigation();if(J.type!=="static"){q[K].vInsetId.push(O.id);y[Q]=O;if(J.typeinfo.pan){O.enablePan()}if(J.type==="panscale"){O.vLod=J.typeinfo.lod;O.setLevel(O.vLod);setTimeout(function(){O.vDeltaX=(Math.abs(O.extent.xmax)-Math.abs(O.extent.xmin))/2;O.vDeltaY=(Math.abs(O.extent.ymax)-Math.abs(O.extent.ymin))/2},1000)}}});return O};n=function(M){var J=z.length,L,N,K;while(J--){N=z[J];L=N.name;if(L!==M){K=q[L];K.setExtent(q[M].extent,K.spatialReference)}}};D=function(M){var J=M.vInsetId.length,L,K;while(J--){L=y[M.vInsetId[J]];if(L.vType==="panscale"){E(M,L)}else{if(L.vType==="link"){L.setExtent(M.extent)}}}};E=function(M,J){var L=e(M),K=new esri.geometry.Extent({xmin:L.x-J.vDeltaX,ymin:L.y-J.vDeltaY,xmax:L.x+J.vDeltaX,ymax:L.y+J.vDeltaY,spatialReference:{wkid:M.spatialReference.wkid}});J.setExtent(K)};o=function(J){J.on("extent-change",i.debounce(function(L){var M=L.target,N=M.id.split("_")[0],K=false;if(p===z.length){K=true}if(K&&!r){setTimeout(function(){n(N)},1000)}if(!u){D(M)}u=false;p-=1;if(p===0){setTimeout(function(){p=z.length},1000)}},1000,false))};w=function(J){J.on("extent-change",i.debounce(function(K){var L=K.target;if(!u){D(L)}u=false},1000,false))};H=function(L,K,J,M){if(K==="tiled"){L.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(J,{id:M}))}else{if(K==="dynamic"){L.addLayer(new esri.layers.ArcGISDynamicMapServiceLayer(J,{id:M}))}else{if(K==="feature"){L.addLayer(new esri.layers.FeatureLayer(J,{mode:esri.layers.FeatureLayer.MODE_ONDEMAND,outFields:["*"],id:M}))}}}};k=function(J){J.resize()};B=function(M,L){var J,K;L=L||{};J=L.point||e(M);K=L.interval||0;k(M);setTimeout(function(){j(M,J)},K)};j=function(K,J){J=J||e(K);K.centerAt(J)};e=function(L){var K,J;K=L.extent;J=new esri.geometry.Point((K.xmin+K.xmax)/2,(K.ymin+K.ymax)/2,L.vWkid);return J};s=function(M,J,L){var K=M.extent;r=L;if(L){u=true}k(M);setTimeout(function(){M.setExtent(K)},J)};h=function(K){var J=new a({targetNodeIds:["gcviz-header"]});J.addChild(new f({label:"Add Point",onClick:function(){alert("click")}}));J.startup()};F=function(J){J.setExtent(l(J,"in"))};v=function(J){J.setExtent(l(J,"out"))};G=function(J){J.setExtent(l(J,"left"))};I=function(J){J.setExtent(l(J,"up"))};C=function(J){J.setExtent(l(J,"right"))};d=function(J){J.setExtent(l(J,"down"))};l=function(J,P){var S=J.extent,O=2,M=4,R,K=S.xmin,N=S.xmax,Q=S.ymin,L=S.ymax;if(P==="up"){R=(L-Q)/O;Q=Q-R;L=L-R}else{if(P==="down"){R=(L-Q)/O;Q=Q+R;L=L+R}else{if(P==="left"){R=(N-K)/O;K=K-R;N=N-R}else{if(P==="right"){R=(N-K)/O;K=K+R;N=N+R}else{if(P==="in"){R=(N-K)/M;K=K+R;N=N-R;R=(L-Q)/M;Q=Q+R;L=L-R}else{if(P==="out"){R=(N-K)/M;K=K-R;N=N+R;R=(L-Q)/M;Q=Q-R;L=L+R}}}}}}S=new esri.geometry.Extent({xmin:K,ymin:Q,xmax:N,ymax:L,spatialReference:{wkid:J.spatialReference.wkid}});return S};return{createMap:A,createInset:b,addLayer:H,resizeMap:k,resizeCenterMap:B,zoomPoint:j,getMapCenter:e,manageScreenState:s,createMapMenu:h,zoomIn:F,zoomOut:v,panLeft:G,panUp:I,panRight:C,panDown:d}})}());