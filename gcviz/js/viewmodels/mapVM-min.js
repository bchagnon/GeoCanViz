(function(){define(["jquery","knockout","gcviz-gismap"],function(e,b,d){var a,c;a=function(f){var g=function(l){var h=this,i=l.mapframe,j=i.id,k=i.map,m;h.init=function(){var q=k.layers,o=q.length,s=e("#"+j+"_holder"),p,r;h.mapholder=s;m=d.createMap(j+"_holder",k,i.extent);q=q.reverse();while(o--){var n=q[o];d.addLayer(m,n.type,n.url,n.id)}p=e("#"+j+"_holder_root");r=e("#"+j+"_holder_container");s.addClass("gcviz-map");p.addClass("gcviz-root");r.addClass("gcviz-container");h.focus(s);h.map=m;return{controlsDescendantBindings:true}};h.enterMouse=function(){h.mapholder.focus()};h.leaveMouse=function(){h.mapholder.blur()};h.focus=function(n){h.mapfocus=b.observable();h.mapfocus.focused=b.observable();h.mapfocus.focused.subscribe(function(o){if(o){h.mapholder.focus();h.mapfocus(true)}else{h.mapholder.blur();h.mapfocus(false)}})};h.applyKey=function(p,o){var q=h.map,n=false;if(h.mapfocus){if(p===37){d.panLeft(q);n=true}else{if(p===38){d.panUp(q);n=true}else{if(p===39){d.panRight(q);n=true}else{if(p===40){d.panDown(q);n=true}else{if((p===187&&o)||(p===61&&o)){d.zoomIn(q);n=true}else{if((p===189&&o)||(p===173&&o)){d.zoomOut(q);n=true}else{if(p===61){n=true}}}}}}}}return n};h.init()};c=new g(f);b.applyBindings(c,f[0]);return c};return{initialize:a}})}).call(this);