(function(){define(["jquery","knockout","gcviz-i18n","gcviz-ko","gcviz-func","gcviz-gismap"],function(g,b,f,h,e,d){var a,c;a=function(j,i){var k=function(o,u){var v=this,w=locationPath+"gcviz/images/headFullscreen.png",q=locationPath+"gcviz/images/headShowInset.png",r=locationPath+"gcviz/images/headSmallscreen.png",n=locationPath+"gcviz/images/headTools.png",x=locationPath+"gcviz/images/headHelp.png",s=g("#section"+u),l=g("#"+u),t=g("#"+u+"_holder"),p=g("#"+u+"_holder_root"),m=vmArray[u].map.map;v.imgFullscreen=b.observable(w);v.imgShowInset=q;v.imgTools=n;v.imgHelp=x;v.tpHelp=f.getDict("%header-tphelp");v.tpTools=f.getDict("%header-tptools");v.tpInset=f.getDict("%header-tpinset");v.tpFullScreen=f.getDict("%header-tpfullscreen");v.isFullscreen=b.observable(false);v.isInsetVisible=b.observable(true);v.insetState=true;v.fullscreenState=0;v.init=function(){v.heightSection=parseInt(s.css("height"),10);v.widthSection=parseInt(s.css("width"),10);v.heightMap=parseInt(t.css("height"),10);v.widthMap=parseInt(t.css("width"),10);v.headerHeight=parseInt(o.css("height"),10);return{controlsDescendantBindings:true}};v.fullscreenClick=function(){e.debounceClick(function(){if(v.fullscreenState){v.cancelFullScreen()}else{v.requestFullScreen()}g(".gcviz-tooltip").remove()},1000)};v.insetClick=function(){e.debounceClick(function(){var y;v.insetState=!v.insetState;v.isInsetVisible(v.insetState);if(v.insetState){y=s.find("[tabindex = 0]");v.first=y[0];v.last=y[y.length-1]}else{y=s.find("[tabindex = 0]").not(".gcviz-inset-button");v.first=y[0];v.last=y[y.length-1]}},1000)};v.toolsClick=function(){var y=l.find(".gcviz-tbholder");if(y.hasClass("gcviz-hidden")){y.removeClass("gcviz-hidden");s.find(".dijitTitlePaneTitleFocus")[0].focus()}else{y.addClass("gcviz-hidden")}};v.helpClick=function(){alert(f.getDict("%header-help"))};v.cancelFullScreen=function(){e.setStyle(s[0],{width:v.widthSection+"px",height:v.heightSection+"px"});e.setStyle(l[0],{width:v.widthSection+"px",height:v.heightSection+"px"});e.setStyle(t[0],{width:v.widthMap+"px",height:v.heightMap+"px"});e.setStyle(p[0],{width:v.widthMap+"px",height:v.heightMap+"px"});s.removeClass("gcviz-sectionfs");v.isFullscreen(false);v.imgFullscreen(w);v.fullscreenState=0;d.manageScreenState(m,500,false);s.off("keydown.fs")};v.requestFullScreen=function(){var A=e.getFullscreenParam(v.widthSection,v.heightSection),y=A.width,z=A.height,B=s.find("[tabindex = 0]");e.setStyle(s[0],{width:screen.width+"px",height:screen.height+"px"});e.setStyle(l[0],{width:y+"px",height:z+"px"});e.setStyle(t[0],{width:y+"px",height:(z-(2*v.headerHeight))+"px"});e.setStyle(p[0],{width:y+"px",height:(z-(2*v.headerHeight))+"px"});s.addClass("gcviz-sectionfs");v.isFullscreen(true);v.imgFullscreen(r);v.fullscreenState=1;d.manageScreenState(m,1000,true);v.first=B[0];v.last=B[B.length-1];s.on("keydown.fs",function(C){v.manageTabbingOrder(C)})};v.manageTabbingOrder=function(z){var A=z.which,y=z.shiftKey,C=z.target,D=v.first,B=v.last;if(A===9&&!y){if(C===B){setTimeout(function(){D.focus()},0)}}else{if(A===9&&y){if(C===D){setTimeout(function(){B.focus()},0)}}}};v.init()};c=new k(j,i);b.applyBindings(c,j[0]);return c};return{initialize:a}})}).call(this);